{"version":3,"file":"index.js","sources":["../src/plugin/meta.ts","../src/plugin/symbols.ts","../src/plugin/registry.ts","../src/plugin/plugin.ts"],"sourcesContent":["import fs from 'node:fs/promises';\r\nimport type { PluginContext } from 'rollup';\r\n\r\nexport interface MetaOptions {\r\n    strict?: boolean;\r\n}\r\n\r\nasync function exists(p: string) {\r\n    try {\r\n        await fs.access(p);\r\n        return true;\r\n    } catch {\r\n        return false;\r\n    }\r\n}\r\n\r\nexport async function fetchVersions(ctx: PluginContext, versionsFile: string, iconsTsFile: string, options: MetaOptions) {\r\n    // Only fetch if file missing\r\n    if (await exists(versionsFile)) return;\r\n\r\n    ctx.info('[material-symbols-svg] Fetching Material Symbols metadata...');\r\n    // Use the correct Material Symbols metadata endpoint; strip XSSI prefix\r\n    const metaUrl = 'https://fonts.google.com/metadata/icons?key=material_symbols&incomplete=true';\r\n    try {\r\n        const res = await fetch(metaUrl);\r\n        if (!res.ok) {\r\n            const msg = `Failed to fetch metadata: HTTP ${res.status}`;\r\n            if (options.strict) ctx.error(`[material-symbols-svg] ${msg}`); else ctx.warn(`[material-symbols-svg] ${msg}`);\r\n            return;\r\n        }\r\n\r\n        let txt = await res.text();\r\n        // The response starts with an XSSI guard like \")]}'\" followed by a newline; remove the first line\r\n        if (txt.startsWith(')]}\\'')) {\r\n            const i = txt.indexOf('\\n');\r\n            if (i !== -1) txt = txt.substring(i + 1);\r\n        }\r\n\r\n        // Transform to { [iconName]: version } like versions.mjs does, filtering out non-symbols\r\n        let parsed: any;\r\n        try {\r\n            parsed = JSON.parse(txt);\r\n        } catch (e) {\r\n            const msg = 'Failed to parse metadata JSON';\r\n            if (options.strict) ctx.error(`[material-symbols-svg] ${msg}`); else ctx.warn(`[material-symbols-svg] ${msg}`);\r\n            parsed = null;\r\n        }\r\n\r\n        if (parsed && Array.isArray(parsed.icons)) {\r\n            const versions: Record<string, string | number> = {};\r\n            for (const icon of parsed.icons) {\r\n                const famsAny = (icon && (icon as any)['unsupported_families']) as any;\r\n                const families: any[] = Array.isArray(famsAny) ? famsAny : [];\r\n                let skip = false;\r\n                for (const fam of families) {\r\n                    if (String(fam).toLowerCase().includes('symbols')) {\r\n                        skip = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (skip) continue;\r\n                const name = String((icon as any)?.name || '');\r\n                if (!name) continue;\r\n                versions[name] = (icon as any)?.version;\r\n            }\r\n            // Sort map by key\r\n            const sorted = Object.fromEntries(Object.entries(versions).sort((a, b) => a[0].localeCompare(b[0])));\r\n            const versionsContent = JSON.stringify(sorted, null, 2);\r\n\r\n            await fs.writeFile(versionsFile, versionsContent);\r\n\r\n            // Generate icons.ts with union of names (from metadata)\r\n            try {\r\n                const names = Object.keys(sorted);\r\n                const union = names\r\n                    .map((n) => `'${n.replace(/'/g, '\\\\\\'')}'`)\r\n                    .join(' | ');\r\n                const banner = `// This file is auto-generated by vite-plugin-material-symbols-svg\\n// Do not edit manually.\\n`;\r\n                const content = `${banner}export type MaterialSymbolIcon = ${union};\\n`;\r\n\r\n                let existing = '';\r\n                try {\r\n                    existing = await fs.readFile(iconsTsFile, 'utf-8');\r\n                } catch {\r\n                    // ignore\r\n                }\r\n\r\n                if (existing !== content) {\r\n                    await fs.writeFile(iconsTsFile, content);\r\n                    const now = new Date();\r\n                    await fs.utimes(iconsTsFile, now, now).catch(() => { });\r\n                }\r\n            } catch (e) {\r\n                // non-fatal\r\n                const msg = e instanceof Error ? e.message : String(e);\r\n                ctx.warn(`[material-symbols-svg] Failed to write icons.ts: ${msg}`);\r\n            }\r\n        } else {\r\n            // Fallback: save cleaned JSON for inspection\r\n            await fs.writeFile(versionsFile, txt);\r\n        }\r\n    } catch (e) {\r\n        const msg = e instanceof Error ? e.message : String(e);\r\n        if (options.strict) ctx.error(`[material-symbols-svg] Metadata prefetch failed: ${msg}`); else ctx.warn(`[material-symbols-svg] Metadata prefetch failed: ${msg}`);\r\n    }\r\n}\r\n","import fs from 'node:fs/promises';\r\nimport { type Theme } from '../shared/types';\r\n\r\nasync function exists(p: string) {\r\n    try {\r\n        await fs.access(p);\r\n        return true;\r\n    } catch {\r\n        return false;\r\n    }\r\n}\r\n\r\nexport function axesString(weight: number, filled: 0 | 1) {\r\n    const w = weight === 400 ? '' : `wght${weight}`;\r\n    const f = filled === 0 ? '' : `fill${filled}`;\r\n    const s = `${w}${f}`;\r\n    return s.length ? s : 'default';\r\n}\r\n\r\nexport function buildSymbolUrl(theme: Theme, icon: string, axes: string, size: number) {\r\n    const themePart = theme || '';\r\n    return `https://fonts.gstatic.com/s/i/short-term/release/materialsymbols${themePart}/${icon}/${axes}/${size}px.svg`;\r\n}\r\n\r\nexport function toFilename(icon: string, filled: 0 | 1, weight: number, size: number) {\r\n    const w = Number.isFinite(weight) ? `.w${weight}` : '';\r\n    const s = Number.isFinite(size) ? `.s${size}` : '';\r\n    const fillPart = filled === 1 ? '-fill' : '';\r\n    return `${icon}${fillPart}${w}${s}.svg`;\r\n}\r\n\r\nasync function removeIfNotSvg(file: string) {\r\n    try {\r\n        const str = await fs.readFile(file, 'utf8');\r\n        const ok = str.startsWith('<svg') && str.includes('</svg>');\r\n        if (!ok) await fs.rm(file, { force: true });\r\n    } catch { /* ignore */\r\n    }\r\n}\r\n\r\nexport async function withConcurrency<T, R>(items: T[], limit: number, worker: (item: T, i: number) => Promise<R>) {\r\n    const ret: R[] = [];\r\n    let idx = 0;\r\n    const run = async () => {\r\n        while (idx < items.length) {\r\n            const i = idx++;\r\n            ret[i] = await worker(items[i], i);\r\n        }\r\n    };\r\n    const runners = Array.from({ length: Math.min(limit, items.length) }, run);\r\n    await Promise.all(runners);\r\n    return ret;\r\n}\r\n\r\nexport async function downloadSymbols(\r\n    tasks: { url: string; file: string }[],\r\n    concurrency: number,\r\n    logger: { info: (msg: string) => void; warn: (msg: string) => void },\r\n) {\r\n    let failed = 0;\r\n    let skipped = 0;\r\n    let saved = 0;\r\n\r\n    await withConcurrency(tasks, concurrency, async (t) => {\r\n        try {\r\n            if (await exists(t.file)) {\r\n                skipped++;\r\n                return;\r\n            }\r\n            const res = await fetch(t.url);\r\n            if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n            const svg = await res.text();\r\n            if (!svg.startsWith('<svg')) throw new Error('Not an SVG');\r\n            await fs.writeFile(t.file, svg);\r\n            await removeIfNotSvg(t.file);\r\n            saved++;\r\n        } catch (e) {\r\n            failed++;\r\n            const msg = e instanceof Error ? e.message : String(e);\r\n            logger.warn(`[material-symbols-svg] Failed ${t.url} -> ${t.file}: ${msg}`);\r\n        }\r\n    });\r\n\r\n    return { saved, skipped, failed };\r\n}\r\n","import fs from 'node:fs/promises';\r\nimport type { PluginContext } from 'rollup';\r\nimport { toFilename } from './symbols';\r\nimport {\r\n    type DefineCustomMap,\r\n    type DefinedIcons,\r\n    type Filled,\r\n    type IconConfig,\r\n    type OpticalSize,\r\n    type SymbolKey,\r\n    type SymbolSvg,\r\n    type Theme,\r\n    type Weight,\r\n} from '../shared/types';\r\nimport { customKeyOf, keyOf, normalizeFills, normalizeNums, normalizeThemes, unique } from '../shared/utils';\r\nimport { MaterialSymbolIcon } from './icons';\r\nimport { symbolConfig } from '../shared/config';\r\n\r\nexport type { OpticalSize, Weight, Filled, Theme, SymbolKey, SymbolSvg, IconConfig, DefinedIcons, DefineCustomMap };\r\n\r\n/**\r\n * defineIcons\r\n * - symbols: the Material Symbols configuration per icon\r\n * - custom: optional custom icons map\r\n * - defaults: optional default config applied to all symbol entries\r\n */\r\nexport function defineIcons<\r\n    S extends Partial<Record<MaterialSymbolIcon, Partial<IconConfig>>>,\r\n    C extends DefineCustomMap = {},\r\n    D extends Partial<IconConfig> = {}\r\n>(\r\n    symbols: S,\r\n    custom: C,\r\n    defaults: D,\r\n): DefinedIcons {\r\n    if (symbolConfig.debug) {\r\n        const symbolCount = Object.keys(symbols || {}).length;\r\n        const customCount = Object.keys(custom || {}).length;\r\n        console.log(`[material-symbols-svg] defineIcons: symbols=${symbolCount}, custom=${customCount}`);\r\n    }\r\n\r\n    return {\r\n        Symbols: symbols as any,\r\n        Custom: (custom ?? ({} as C)),\r\n        Default: (defaults ?? ({} as D)),\r\n    } as const;\r\n}\r\n\r\nexport const IconDefaultConfig = {\r\n    sizes: [20, 24, 40, 48] as const,\r\n    weights: [400] as const,\r\n    fills: [0] as const,\r\n    themes: ['rounded'] as const,\r\n};\r\n\r\nexport async function generateConsumerFiles(\r\n    ctx: PluginContext,\r\n    iconsDef: DefinedIcons,\r\n    loaderTypesFile: string,\r\n    loaderMapFile: string,\r\n    distDir: string,\r\n) {\r\n    const banner = `// This file is auto-generated by vite-plugin-material-symbols-svg\\n// Do not edit manually.\\n`;\r\n\r\n    // 1. Generate loader-types.ts (IconKey)\r\n    try {\r\n        ctx.warn(`[material-symbols-svg] Generate loader-types.ts`);\r\n        const symKeys = Object.keys(iconsDef.Symbols || {});\r\n        const customKeys = Object.keys(iconsDef.Custom || {});\r\n        const all = Array.from(new Set([...symKeys, ...customKeys]));\r\n        const keyUnion = all.length\r\n            ? all.map((n) => `'${n.replace(/'/g, '\\\\\\'')}'`).join(' | ')\r\n            : 'string';\r\n        const typeContent = `${banner}export type IconKey = ${keyUnion};\\n`;\r\n\r\n        await fs.mkdir(distDir, {recursive: true});\r\n\r\n        let existing = '';\r\n        try {\r\n            existing = await fs.readFile(loaderTypesFile, 'utf-8');\r\n        } catch {\r\n        }\r\n\r\n        if (existing !== typeContent) {\r\n            await fs.writeFile(loaderTypesFile, typeContent);\r\n            const now = new Date();\r\n            await fs.utimes(loaderTypesFile, now, now).catch(() => {\r\n            });\r\n        }\r\n    } catch (e) {\r\n        const msg = e instanceof Error ? e.message : String(e);\r\n        ctx.warn(`[material-symbols-svg] Failed to write loader-types.ts: ${msg}`);\r\n    }\r\n\r\n    // 2. Generate loader-map.js\r\n    try {\r\n        ctx.warn(`[material-symbols-svg] Generate loader-map.js`);\r\n        const imports: string[] = [];\r\n        const mapEntries: string[] = [];\r\n        const defaults: Partial<IconConfig> = iconsDef.Default ?? {};\r\n\r\n        let i = 0;\r\n        for (const [icon, meta] of Object.entries(iconsDef.Symbols || {})) {\r\n            const sizes = normalizeNums((meta.sizes ?? defaults.sizes), IconDefaultConfig.sizes);\r\n            const weights = normalizeNums((meta.weights ?? defaults.weights), IconDefaultConfig.weights);\r\n            const fills = normalizeFills((meta.fills ?? defaults.fills), IconDefaultConfig.fills);\r\n            const themes = normalizeThemes((meta.themes ?? defaults.themes), IconDefaultConfig.themes);\r\n\r\n            for (const theme of unique(themes)) {\r\n                for (const weight of unique(weights)) {\r\n                    for (const filled of unique(fills)) {\r\n                        const key = keyOf({ theme, icon, filled, weight } as any);\r\n                        const entries: string[] = [];\r\n                        for (const size of unique(sizes)) {\r\n                            const filename = toFilename(icon, filled as 0 | 1, weight, size);\r\n                            const importPath = `/symbols/${theme}/${filename}?raw`;\r\n                            const varName = `i${i++}`;\r\n                            imports.push(`import ${varName} from '${importPath}';`);\r\n                            entries.push(`      ${size}: ${varName}`);\r\n                        }\r\n                        mapEntries.push(`  '${key}': {\\n${entries.join(',\\n')}\\n  },`);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Add custom icons to the map\r\n        for (const [icon, sizesObj] of Object.entries(iconsDef.Custom || {})) {\r\n            const key = customKeyOf({ icon } as any);\r\n            const entries: string[] = [];\r\n            for (const [sizeKey, val] of Object.entries(sizesObj as any || {})) {\r\n                let value = val;\r\n                if (value && typeof value === 'object' && 'then' in value && typeof (value as any).then === 'function') {\r\n                    value = await value;\r\n                }\r\n\r\n                if (typeof value === 'string' && (value.startsWith('./') || value.startsWith('../'))) {\r\n                    const varName = `i${i++}`;\r\n                    imports.push(`import ${varName} from '${value}?raw';`);\r\n                    entries.push(`      ${sizeKey}: ${varName}`);\r\n                } else if (value) {\r\n                    // It's already imported or literal content\r\n                    const content = (typeof value === 'object' && 'default' in value)\r\n                        ? (value as any).default\r\n                        : value;\r\n\r\n                    if (typeof content === 'string') {\r\n                        entries.push(`      ${sizeKey}: ${JSON.stringify(content)}`);\r\n                    }\r\n                }\r\n            }\r\n            if (entries.length) {\r\n                mapEntries.push(`  '${key}': {\\n${entries.join(',\\n')}\\n  },`);\r\n            }\r\n        }\r\n\r\n        const mapContent = `${banner}${imports.join('\\n')}\\n\\nexport default {\\n${mapEntries.join('\\n')}\\n};\\n`;\r\n\r\n        let existing = '';\r\n        try {\r\n            existing = await fs.readFile(loaderMapFile, 'utf-8');\r\n        } catch {\r\n        }\r\n\r\n        if (existing !== mapContent) {\r\n            await fs.writeFile(loaderMapFile, mapContent);\r\n            const now = new Date();\r\n            await fs.utimes(loaderMapFile, now, now).catch(() => {\r\n            });\r\n        }\r\n    } catch (e) {\r\n        const msg = e instanceof Error ? e.message : String(e);\r\n        ctx.warn(`[material-symbols-svg] Failed to write loader-map.js: ${msg}`);\r\n    }\r\n}\r\n","import path from 'node:path';\r\nimport fs from 'node:fs/promises';\r\nimport type { Plugin } from 'vite';\r\nimport { fetchVersions } from './meta';\r\nimport { axesString, buildSymbolUrl, downloadSymbols, toFilename } from './symbols';\r\nimport { type DefinedIcons as IconsInput, generateConsumerFiles, IconConfig, IconDefaultConfig } from './registry';\r\nimport { Theme } from '../shared/types';\r\nimport { normalizeFills, normalizeNums, normalizeThemes, unique } from '../shared/utils';\r\nimport { configureSymbolConfig } from '../shared/config';\r\n\r\nexport interface MaterialSymbolsPluginOptions {\r\n    concurrency?: number;\r\n    strict?: boolean;                // fail build when downloads fail\r\n    enabled?: boolean;\r\n    debug?: boolean;\r\n}\r\n\r\nasync function ensureDir(dir: string) {\r\n    await fs.mkdir(dir, {recursive: true});\r\n}\r\n\r\nexport function materialSymbolsSvg(iconsDef: IconsInput, opts: MaterialSymbolsPluginOptions = {}): Plugin {\r\n    const options = {\r\n        concurrency: opts.concurrency ?? 8,\r\n        strict: opts.strict ?? false,\r\n        enabled: opts.enabled ?? true,\r\n        debug: opts.debug ?? (typeof process !== 'undefined' && process.env.NODE_ENV !== 'production'),\r\n    } as Required<MaterialSymbolsPluginOptions>;\r\n\r\n    configureSymbolConfig({debug: options.debug});\r\n\r\n    if (!iconsDef || !iconsDef.Symbols) {\r\n        throw new Error('[material-symbols-svg] First parameter must be the return value of defineIcons()');\r\n    }\r\n\r\n    let root = '';\r\n    return {\r\n        name: 'material-symbols-svg',\r\n        configResolved(config) {\r\n            root = config.root || process.cwd();\r\n        },\r\n        config(config) {\r\n            const symbolsPath = path.resolve(\r\n                root || process.cwd(),\r\n                'node_modules',\r\n                '@hyrioo',\r\n                'vite-plugin-material-symbols-svg',\r\n                '.temp',\r\n                'symbols',\r\n            );\r\n            const alias = config.resolve?.alias || {};\r\n            const symbolsAlias = {find: '/symbols', replacement: symbolsPath};\r\n\r\n            const newAlias = Array.isArray(alias)\r\n                ? [...alias, symbolsAlias]\r\n                : {...alias, '/symbols': symbolsPath};\r\n\r\n            return {\r\n                resolve: {\r\n                    alias: newAlias,\r\n                },\r\n            };\r\n        },\r\n        async buildStart() {\r\n            if (!options.enabled) return;\r\n\r\n            const tempDir = path.resolve(root, 'node_modules', '@hyrioo', 'vite-plugin-material-symbols-svg', '.temp');\r\n            const outBase = path.resolve(tempDir, 'symbols');\r\n            const distDir = path.resolve(root, 'node_modules', '@hyrioo', 'vite-plugin-material-symbols-svg', 'dist');\r\n            const srcPluginDir = path.resolve(root, 'node_modules', '@hyrioo', 'vite-plugin-material-symbols-svg', 'dist', 'src', 'plugin');\r\n            const srcConsumerDir = path.resolve(root, 'node_modules', '@hyrioo', 'vite-plugin-material-symbols-svg', 'dist', 'src', 'consumer');\r\n\r\n            const versionsFile = path.resolve(tempDir, 'versions.json');\r\n\r\n            // These are the new consumer files\r\n            const iconsTsFile = path.resolve(srcPluginDir, 'icons.d.ts');\r\n            const loaderTypesFile = path.resolve(srcConsumerDir, 'loader-types.d.ts');\r\n            const loaderMapFile = path.resolve(distDir, 'loader-map.js');\r\n\r\n            await ensureDir(tempDir);\r\n\r\n            // 1. Fetch metadata and generate icons.ts\r\n            await fetchVersions(this, versionsFile, iconsTsFile, {strict: options.strict});\r\n\r\n            // 2. Generate consumer loader files (loader-types.ts, loader-map.js)\r\n            await generateConsumerFiles(this, iconsDef, loaderTypesFile, loaderMapFile, srcConsumerDir);\r\n\r\n            // 3. Prepare download tasks\r\n            const iconsMap = iconsDef.Symbols;\r\n            const defaults: Partial<IconConfig> = iconsDef.Default ?? {};\r\n            const tasks: {url: string; file: string}[] = [];\r\n\r\n            for (const [icon, meta] of Object.entries(iconsMap)) {\r\n                const sizes = normalizeNums((meta.sizes ?? defaults.sizes), IconDefaultConfig.sizes);\r\n                const weights = normalizeNums((meta.weights ?? defaults.weights), IconDefaultConfig.weights);\r\n                const fills = normalizeFills((meta.fills ?? defaults.fills), IconDefaultConfig.fills);\r\n                const themes = normalizeThemes((meta.themes ?? defaults.themes), IconDefaultConfig.themes);\r\n\r\n                for (const theme of unique(themes)) {\r\n                    await ensureDir(path.resolve(outBase, theme));\r\n                    for (const weight of unique(weights)) {\r\n                        for (const filled of unique(fills)) {\r\n                            for (const size of unique(sizes)) {\r\n                                const axes = axesString(weight, filled);\r\n                                const url = buildSymbolUrl(theme as Theme, icon, axes, size);\r\n                                const file = path.resolve(outBase, theme, toFilename(icon, filled as 0 | 1, weight, size));\r\n                                tasks.push({url, file});\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // 4. Download icons\r\n            this.warn(`[material-symbols-svg] Downloading symbols`);\r\n            const result = await downloadSymbols(tasks, options.concurrency, this);\r\n\r\n            const summary = `[material-symbols-svg] Done. Saved: ${result.saved}, Skipped: ${result.skipped}, Failed: ${result.failed}`;\r\n            if (result.failed > 0 && options.strict) this.error(summary); else this.info(summary);\r\n        },\r\n    };\r\n}\r\n"],"names":["exists","i"],"mappings":"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"}